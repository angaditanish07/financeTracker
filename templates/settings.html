{% extends "base.html" %}

{% block title %}Settings - FinanceTracker{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-cog me-2"></i>Account Settings</h5>
            </div>
            <div class="card-body">
                <form id="settingsForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-control" id="username" value="{{ current_user.username }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" value="{{ current_user.email }}">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Currency (ISO code)</label>
                            <input type="text" class="form-control" id="currency_code" value="{{ current_user.currency_code or 'INR' }}">
                            <div class="form-text">Example: INR, USD, EUR</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Budget month start day</label>
                            <input type="number" class="form-control" id="month_start_day" value="{{ current_user.month_start_day or 1 }}" min="1" max="28">
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">New Password</label>
                            <input type="password" class="form-control" id="new_password" placeholder="Leave blank to keep current">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="confirm_password">
                        </div>
                    </div>
                    <div class="d-flex justify-content-end">
                        <button type="button" class="btn btn-primary" onclick="submitSettings()">
                            <i class="fas fa-save me-2"></i>Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function submitSettings() {
    const payload = {
        username: document.getElementById('username').value,
        email: document.getElementById('email').value,
        currency_code: document.getElementById('currency_code').value,
        month_start_day: document.getElementById('month_start_day').value,
        new_password: document.getElementById('new_password').value,
        confirm_password: document.getElementById('confirm_password').value,
    };
    try {
        const res = await fetch('/settings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (res.ok) {
            showAlert('Settings updated.', 'success');
            document.getElementById('new_password').value = '';
            document.getElementById('confirm_password').value = '';
        } else {
            showAlert(data.error || 'Failed to update settings.', 'danger');
        }
    } catch (e) {
        showAlert('An error occurred. Please try again.', 'danger');
    }
}
</script>
{% endblock %}


